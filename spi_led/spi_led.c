#include <stdio.h>
#include <string.h>
#include <unistd.h>
#include <fcntl.h>
#include <errno.h>

//#define DEVICE	"/dev/spi_led"
#define FB_SIZE	(128*64/8)
#define ROW		8
#define COL		128

static unsigned char bmp[FB_SIZE]= {
//myir.bmp0
0x00,0x00,0x00,0x00,0xC0,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xC0,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xC0,0xFE,0xFE,0xFE,
0xFE,0xFE,0xFE,0xFE,0xFE,0xFC,0x00,0x00,0xFE,0xFE,0xFE,0xFE,0xFC,0xFC,0xFC,0xFC,
0xF8,0xF8,0xF0,0xF0,0xE0,0xC0,0xC0,0x80,0x00,0x00,0x00,0x00,0x00,0x80,0xC0,0xE0,
0xF0,0xF0,0xF8,0xF8,0xFC,0xFC,0xFC,0xFE,0xFE,0xFE,0xFE,0xFE,0x00,0x00,0x50,0xFC,
0xFE,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFE,0xFC,0x00,0x00,0x00,0x00,0xFE,0xFE,0xFE,
0xFE,0xFE,0xFE,0xFE,0xFE,0x7E,0x7E,0x7E,0x7E,0x7E,0x7E,0x7E,0x7E,0x7E,0x7E,0x7E,
0x7E,0x7E,0x7E,0xFE,0xFE,0xFE,0xFE,0xFC,0xFC,0xF8,0xF8,0xF0,0xC0,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFC,0xF0,
0xC0,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0xC0,0xC0,0xF0,0xFC,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xD0,0x00,0x03,0x03,0x03,0x03,0x07,0x07,0x07,0x0F,
0x0F,0x1F,0x3F,0x7F,0xFF,0xFF,0xFF,0xFF,0xFE,0xFC,0xFC,0xFE,0xFF,0xFF,0xFF,0xFF,
0x7F,0x3F,0x1F,0x0F,0x0F,0x07,0x07,0x03,0x03,0x03,0x03,0x03,0x00,0x00,0x00,0x00,
0xE1,0xE3,0xF7,0xF7,0xF7,0xF3,0xF3,0xE1,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,
0xC0,0xC0,0xC0,0xE0,0xF1,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x7F,0x00,0x00,0x00,
0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x0F,0x1F,0x3F,0x7F,0x7F,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x7F,0x3F,0x3F,0x1F,0x07,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x03,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x07,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0x1F,0x1F,0x1F,0x1F,0x1F,0x1F,0x1F,0x1F,0x1F,0x1F,0x1F,
0x3F,0x3F,0x7F,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xF3,0xF1,0xC0,0x00,0x00,0x00,0x00,
0x00,0x00,0xF4,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x01,0x01,0x01,0x01,0x01,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1F,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x01,0x7F,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xC0,0x00,0x00,
0x00,0x00,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x00,0x00,0x00,0x00,0x00,0x01,0x01,0x01,
0x01,0x01,0x01,0x01,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x00,0x00,
0x00,0x00,0x00,0x38,0xFC,0xF8,0xFC,0xF8,0xE0,0xC0,0xC0,0xC0,0xC0,0xF8,0xFC,0xFC,
0xFC,0xFC,0xFC,0xC0,0xC0,0xC0,0xC0,0xE0,0xF8,0xF8,0xFC,0xF8,0x7C,0x08,0x00,0x00,
0x00,0x00,0x00,0xC0,0xC0,0xF0,0xFC,0xFC,0xFC,0xFC,0x7C,0x78,0x78,0x78,0x78,0x78,
0x78,0x78,0x78,0x78,0x78,0x78,0x78,0x78,0x78,0x78,0xF8,0xF8,0xF8,0xF8,0xF0,0x00,
0x00,0x00,0xB8,0xB8,0xB8,0xB8,0xB8,0xF8,0xF8,0xF8,0xF8,0xF8,0xFC,0xBC,0xBC,0xBC,
0x1C,0xF8,0xF8,0xF8,0xF8,0xE0,0x80,0x80,0xFC,0xFC,0xFC,0xFC,0x54,0x00,0x00,0x00,
0x00,0x00,0x78,0x78,0x78,0x78,0x78,0x78,0xFC,0xFC,0xFC,0xFC,0xFC,0xF8,0x70,0x78,
0x70,0x78,0x70,0xFC,0xFC,0xFC,0xFC,0xFC,0x70,0x78,0x70,0x78,0x70,0x78,0x00,0x00,
0x00,0x00,0x3C,0x3C,0x3D,0x3D,0xBF,0xFF,0xFF,0xFF,0xFF,0xFF,0x7F,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0x3F,0xFF,0xFF,0xFF,0xFF,0xFF,0xBF,0x3D,0x3C,0x3C,0x3C,0x00,0x00,
0x00,0x00,0x00,0x03,0x03,0x03,0xF3,0xFF,0xFD,0xFC,0xFC,0x3C,0x00,0x00,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFE,0x00,0x1C,0xFC,0xFC,0xFC,0xFC,0xFB,0x83,0x03,0x03,0x01,0x00,
0x00,0x00,0x07,0x07,0x87,0xF7,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xC7,0x07,
0x07,0xFB,0xFF,0xFB,0xFF,0xE3,0xC3,0xC3,0xFF,0xFF,0xFF,0xFF,0x55,0x00,0x00,0x00,
0x00,0x00,0x00,0x80,0xC0,0xF0,0xFC,0xFE,0xFF,0xFF,0xFF,0xFF,0xFF,0x07,0x1E,0x3E,
0x7E,0xFE,0xFE,0xEF,0xEF,0xCF,0xCF,0xEF,0xFE,0xFE,0xFE,0x7E,0x3E,0x0E,0x00,0x00,
0x00,0x60,0xE0,0xF0,0xF8,0xFE,0xFF,0x7F,0x7F,0x1F,0x07,0x01,0x00,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0x00,0x01,0x07,0x1F,0x7F,0x7F,0xFF,0xFE,0xF8,0xE0,0xE0,0x00,0x00,
0x00,0x00,0x00,0xF0,0xF0,0xFF,0xFF,0xFF,0x7F,0x1F,0x01,0xC0,0xE0,0xE0,0xFF,0xFF,
0xFF,0xFF,0xFF,0x3F,0x00,0x00,0x01,0x1F,0x7F,0xFF,0xFF,0xFF,0xF0,0xF0,0x70,0x00,
0x00,0x00,0xF0,0xFC,0xFF,0x7F,0x1F,0xFF,0xFF,0xFF,0xFF,0xFF,0x3F,0xFF,0xFF,0xFF,
0x7C,0x3C,0x3D,0x3D,0x3D,0x3D,0x3D,0x3D,0xFF,0xFF,0xFF,0xFF,0x5F,0x1E,0x00,0x00,
0x00,0x0E,0x7F,0xFF,0xF7,0xE7,0xF3,0xF0,0xFF,0xFF,0x7F,0x7F,0x7F,0xE0,0xF0,0xF0,
0xF0,0xF8,0xFD,0x7F,0x7F,0x1F,0x1F,0x7F,0x7F,0xF9,0xF0,0xF0,0xF0,0xE0,0x00,0x00,
};

void do_shift(void)
{
	char tmp[128];
	memcpy(tmp, bmp, sizeof(tmp));
	memmove(bmp, &bmp[sizeof(tmp)], sizeof(bmp)-sizeof(tmp));
	memcpy(&bmp[sizeof(bmp)-sizeof(tmp)], tmp, sizeof(tmp));
}

int spi_led_test(const char *dev)
{
	int fd, ret;
	
	fd = open(dev, O_RDWR);
	if (fd < 0) {
		fprintf(stderr, "open device %s failed!\n", dev);
		return -1;
	}
	
		ret = write(fd, bmp, sizeof(bmp));
		if (ret != sizeof(bmp)) {
			fprintf(stderr, "write data failed!\n");
			close(fd);
			return -1;
		}
		do_shift();
		usleep(200*1000);

	
	printf("write bmp data success!\n");
	
	close(fd);
	return 0;
}